<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Inventario â€” Modern</title>

    <!-- Bootstrap CSS + Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root{
            --accent:#0d6efd;
            --danger-strong:#b71c1c;
        }
        .table-modern tbody tr:hover { background: rgba(13,110,253,0.03); }
        .low-stock-row { background:#feecec !important; }
        .low-stock-badge { background:var(--danger-strong); color:#fff; font-weight:600; }
        .table th:nth-child(6), .table td:nth-child(6) { display:none; }
        .search-input .form-control { padding-left:2.5rem; }
        .search-input .bi-search { left:0.9rem; top:0.7rem; position:absolute; color:#6c757d; }
        .stats .card { border:0; box-shadow:0 1px 6px rgba(0,0,0,0.04); }
        .desc-cell { max-width:320px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    </style>
</head>
<body class="bg-light">
<nav class="navbar navbar-expand bg-white border-bottom mb-4">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold d-flex align-items-center" href="{{ url_for('index') }}">
            <img src="{{ url_for('static', filename='logo.png') }}"
                 alt="LSI Group"
                 style="height:40px; margin-right:10px;"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block'">
            <span style="display:none;">LSI Group</span>
            <span class="ms-1">ðŸ“¦ Inventario</span>
        </a>
        <div class="d-flex gap-2">
            <a href="{{ url_for('agregar') }}" class="btn btn-primary btn-sm"><i class="bi bi-plus-lg"></i> Agregar</a>
            <a href="{{ url_for('exportar', ubicacion=ubicacion_filtro, busqueda=busqueda) }}" class="btn btn-success btn-sm"><i class="bi bi-download"></i> Exportar</a>
        </div>
    </div>
</nav>

<div class="container">
    <!-- resumen -->
    <div class="row mb-3 stats">
        <div class="col-sm-6 col-md-3 mb-2">
            <div class="card p-2">
                <div class="d-flex align-items-center">
                    <div class="me-3 display-6 text-muted"><i class="bi bi-box-seam"></i></div>
                    <div>
                        <div class="text-muted small">Total</div>
                        <div class="fs-5">{{ items|length }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bajo stock clickeable sin badge -->
        <div class="col-sm-6 col-md-3 mb-2">
            <a href="{{ url_for('index', solo_bajo_stock=1, ubicacion=ubicacion_filtro, busqueda=busqueda) }}"
               class="card p-2 text-decoration-none text-reset" style="display:block">
                <div class="d-flex align-items-center">
                    <div class="me-3 display-6 text-danger">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                    </div>
                    <div>
                        <div class="text-muted small">Bajo stock</div>
                        <div class="fs-5 text-danger">{{ low_count }}</div>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-md-6 d-none d-md-block"></div>
    </div>

    <!-- BotÃ³n para volver a todos los productos si estÃ¡ el filtro de Bajo Stock -->
    {% if request.args.get('solo_bajo_stock') %}
        <div class="mb-3">
            <a href="{{ url_for('index', ubicacion=ubicacion_filtro, busqueda=busqueda) }}" class="btn btn-outline-secondary">
                Ver todos los productos
            </a>
        </div>
    {% endif %}

    <!-- filtros / bÃºsqueda -->
    <form method="get" class="row g-2 align-items-center mb-3">
        <div class="col-sm-8 col-md-6 position-relative search-input">
            <i class="bi bi-search"></i>
            <input id="busqueda" name="busqueda" type="search" class="form-control" placeholder="Buscar por cÃ³digo, descripciÃ³n o marca" value="{{ busqueda }}">
        </div>

        <div class="col-sm-4 col-md-3">
            <input id="ubicacion" name="ubicacion" type="text" class="form-control" placeholder="UbicaciÃ³n (opcional)" value="{{ ubicacion_filtro }}">
        </div>

        <div class="col-auto">
            <button type="submit" class="btn btn-outline-primary">Filtrar</button>
        </div>
        <div class="col-auto">
            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">Limpiar</a>
        </div>
    </form>

    <!-- tabla moderna con checkboxes -->
    <form id="tabla-form" method="post" action="{{ url_for('exportar_seleccionados') }}">
        <div class="table-responsive shadow-sm bg-white rounded">
            <table class="table table-modern table-hover mb-0 align-middle">
                <thead class="table-light">
                    <tr>
                        <th><input type="checkbox" id="checkAll"></th>
                        <th class="text-muted small">ID</th>
                        <th class="text-muted small">Marca</th>
                        <th class="text-muted small">CÃ³digo</th>
                        <th class="text-muted small">DescripciÃ³n</th>
                        <th class="text-muted small">Cantidad</th>
                        <th class="text-muted small">MÃ­nimo</th>
                        <th class="text-muted small">UbicaciÃ³n</th>
                        <th class="text-muted small">Estado</th>
                        <th class="text-end text-muted small">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                {% for item in items %}
                    <tr class="{% if item['CANTIDAD'] <= item['MINIMO'] %}low-stock-row{% endif %}">
                        <td><input type="checkbox" name="seleccionados" value="{{ item['id'] }}"></td>
                        <td class="small text-muted">{{ item['id'] }}</td>
                        <td>{{ item['MARCA'] }}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div>{{ item['CODIGO'] }}</div>
                                {% if item['CANTIDAD'] <= item['MINIMO'] %}
                                    <div class="ms-2"><span class="badge low-stock-badge">âš </span></div>
                                {% endif %}
                            </div>
                        </td>
                        <td class="desc-cell">{{ item['DESCRIPCION'] }}</td>
                        <td>{{ item['CANTIDAD'] }}</td>
                        <td>{{ item['MINIMO'] }}</td>
                        <td>{{ item['UBICACION'] }}</td>
                        <td>
                            {% if item['CANTIDAD'] <= item['MINIMO'] %}
                                <span class="badge bg-danger">Bajo</span>
                            {% else %}
                                <span class="badge bg-success">OK</span>
                            {% endif %}
                        </td>
                        <td class="text-end">
                            <div class="btn-group" role="group">
                                <a href="{{ url_for('detalle', id=item['id']) }}" class="btn btn-sm btn-outline-info" title="Ver"><i class="bi bi-eye"></i></a>
                                <a href="{{ url_for('editar', id=item['id']) }}" class="btn btn-sm btn-outline-primary" title="Editar"><i class="bi bi-pencil"></i></a>
                                <a href="{{ url_for('eliminar', id=item['id']) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Eliminar producto?')" title="Eliminar"><i class="bi bi-trash"></i></a>
                            </div>
                        </td>
                    </tr>
                {% else %}
                    <tr><td colspan="10" class="text-center py-4 text-muted">No hay productos</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <button type="submit" class="btn btn-success mt-2">Exportar seleccionados a Excel</button>
    </form>
</div>

<script>
document.getElementById('checkAll').onclick = function() {
    var checks = document.querySelectorAll('input[name="seleccionados"]');
    for (var c of checks) c.checked = this.checked;
};
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>